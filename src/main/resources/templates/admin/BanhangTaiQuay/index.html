<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ban Hang</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <link rel="stylesheet" th:href="@{/css/taiquay.css}">
</head>
<body class="container-fluid">
<article th:replace="~{admin/fragments/article :: article}"></article>
<header th:replace="~{admin/fragments/header :: header}"></header>
<nav th:replace="~{admin/fragments/nav :: nav}"></nav>

<section class="page-content my-4">
    <h4 style="margin-left: 30px; margin-top: 10px; margin-bottom: 30px"><b>Bán hàng tại quầy</b></h4>
    <form id="createInvoiceForm">
        <button id="btnCreateInvoice" style="background-color: #ff6b6b; border-radius: 20px; border: 1px solid #ccc;"
                type="button"><i class="bi bi-align-center">Tạo Hóa Đơn</i></button>
    </form>
    <div class="container">
        <!-- Tạo Hóa Đơn và Hiển Thị Hóa Đơn -->
        <!--        <div class="sectionhoadon">-->
<!--        <div id="invoiceList" style="margin-top: 20px;">-->
<!--            <ul style="list-style-type: none; padding: 0; display: flex; flex-wrap: wrap;">-->
<!--                <li class="invoice-item" th:each="hoaDon : ${listHD}"-->
<!--                    style="margin-right: 15px;">-->
<!--                    <a th:href="@{/admin/taiquay/detail/{id}(id=${hoaDon.id})}"-->
<!--                       th:text="'Hóa đơn ' + ${hoaDon.id}" style="text-decoration: none;" class="invoice-link"></a>-->
<!--                    <span class="invoice-close-btn" data-invoice-id="${hoaDon.id}">&times;</span>-->
<!--&lt;!&ndash;                    <span class="invoice-id" th:text="${hoaDon.id}" style="display: none;"></span>&ndash;&gt;-->
<!--                </li>-->
<!--            </ul>-->
<!--        </div>-->
        <div id="invoiceList" style="margin-top: 20px;">
            <ul style="list-style-type: none; padding: 0; display: flex; flex-wrap: wrap;">
                <li class="invoice-item" th:each="hoaDon : ${listHD}" th:attr="data-id=${hoaDon.id}" style="margin-right: 15px;">
                    <a th:href="@{/admin/taiquay/detail/{id}(id=${hoaDon.id})}"
                       th:text="'Hóa đơn ' + ${hoaDon.id}" style="text-decoration: none;" class="invoice-link"></a>
                    <span class="invoice-close-btn">&times;</span>
                </li>
            </ul>
        </div>



        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


        <div class="section">
            <div>
                <button class="btn btn-light" id="btnQR">Quét Mã QR</button>
                <a class="taiquay"><a th:href="@{/admin/taiquay/sanpham#sanpham}">
                    <button class="btn btn-light">Thêm Sản Phẩm</button>
                </a></a>
            </div>
            <div class="container-row">
                <div class="custom-table">
                    <div class="custom-table1">
                        <table class="table table-bordered table-hover text-center ">
                            <thead class="table-light">
                            <tr>
                                <th scope="col">STT</th>
                                <th scope="col">Sản Phẩm</th>
                                <th scope="col">SL</th>
                                <th scope="col">Đơn Giá</th>
                                <th scope="col">Tổng</th>
                                <th scope="col">Thao Tác</th>
                            </tr>
                            </thead>
                            <tbody id="cartTable1">
                            <tr th:each="hdct,stt : ${listHDCT}">
                                <td th:text="${stt.index + 1}"></td>
                                <td th:text="${hdct.sanPhamChiTiet.sanPham.tenSanPham}"></td>
                                <td th:text="${hdct.soLuong}"></td>
                                <td th:text="${#numbers.formatDecimal(hdct.sanPhamChiTiet.gia, 1, 'COMMA', 0, 'POINT')} + 'đ'"></td>
<!--                                <p class="price" th:text="${#numbers.formatDecimal(sanpham.gia, 1, 'COMMA', 0, 'POINT')} + 'đ'"></p>-->
                                <td th:text="${#numbers.formatDecimal(hdct.sanPhamChiTiet.gia.multiply(hdct.soLuong),1, 'COMMA', 0, 'POINT')}+ 'đ'"></td>
                                <td><a th:href="@{/admin/taiquay/xoa-sanpham-hdct/{id}(id=${hdct.id})}"
                                       class="btn btn-light" title="Xóa"><i class="bi bi-trash-fill fs-5"></i></a></td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="custom-note-row">
                        <span class="note">Tổng tiền đơn hàng : </span>
                        <span class="total" th:text="${#numbers.formatDecimal(tongTien, 1, 'COMMA', 0, 'POINT')}"></span> vnđ
                    </div>
                </div>
                <div class="payment-info">
                    <p style="margin-top: 7px;margin-bottom: 7px;"><b><i class="bi bi-diamond-fill fs3">Thông tin thanh toán</i></b></p>

                    <div style="display: flex; align-items: center; gap: 20px;">
                        <form th:action="@{/admin/taiquay/tim-kiem}" method="get"
                              style="display: flex; align-items: center; gap: 10px;">
                            <input type="text" id="soDienThoai" name="soDienThoai" required
                                   style="padding: 5px; border-radius: 5px; border: 1px solid #ddd; width: 200px;">
                            <button type="submit"
                                    style="background-color: #2c3e50; color: white;margin-bottom: 5px; padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer;">
                                Tìm kiếm KH
                            </button>
                        </form>
                    </div>
                    <div class="half">
                        <!-- Tên Khách Hàng -->
                        <div style="display: flex; align-items: center; margin-bottom: 5px; width: 300px;">
                            <span style="font-size: 14px; margin-top: 10px;">Tên Khách Hàng:</span>
                            <span th:text="${khachHang != null ? khachHang.ten : 'Khách lẻ'}"
                                  style="font-size: 14px;margin-top: 10px; color: #2c3e50; background-color: #f0f0f0; padding: 5px 10px; border-radius: 5px; margin-left: 10px;"></span>
                        </div>
                        <!-- Số Điện Thoại -->
                        <div style="display: flex; align-items: center;width: 300px;">
                            <span style="font-size: 14px; margin-top: 10px;">Số điện thoại:</span>
                            <span th:text="${khachHang != null ? khachHang.soDienThoai : ''}"
                                  style="font-size: 14px; margin-top: 10px; color: #2c3e50; background-color: #f0f0f0; padding: 5px 10px; border-radius: 5px; margin-left: 10px;"></span>
                        </div>
                    </div>

                    <div style="display: flex; align-items: center; gap: 20px;">
                        <form id="formGiamGia" th:action="@{/admin/taiquay/kiemtrama}" method="post" class="discount-form">
                            <input type="text" name="maphieugiamgia" placeholder="Nhập mã giảm giá" th:value="${maPhieuGiamGia}" />
                            <button type="submit" class="apply-button" style="background-color: #2c3e50; color: white;margin-bottom: 5px; padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer;">Áp dụng</button>
                        </form>
                        <div class="discount-code-container">
                            <a class="taiquay" th:href="@{/admin/taiquay/phieugiamgia#phieugiamgia}">
                                <button id="choose" class="discount-code-button" style="background-color: #2c3e50; color: white;margin-bottom: 5px; padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer;">
                                    Mã PGG
                                </button>
                            </a>
                        </div>
                    </div>

                    <div id="phieugiamgia" class="dialogmodal">
                        <div class="modal__center">
                            <div th:replace="~{admin/BanhangTaiQuay/tablePhieuGiamGia :: form}"></div>
                            <div th:replace="~{admin/BanhangTaiQuay/tablePhieuGiamGia :: table}"></div>


                            <a th:href="@{/admin/taiquay/detail/{id}(id=${idHoaDon})}" class="modal__close">&times;</a>
                            <div>
                                <div class="d-flex align-items-center">
                                    <label for="itemsPerPage" class="me-2">Xem</label>
                                    <select class="form-select form-select-sm" id="itemsPerPage" name="size"
                                            style="width: 80px;"
                                            onchange="changeItemsPerPage()">
                                        <option value="5" th:selected="${size == 5}">5</option>
                                        <option value="10" th:selected="${size == 10}">10</option>
                                        <option value="15" th:selected="${size == 15}">15</option>
                                        <option value="20" th:selected="${size == 20}">20</option>
                                    </select>
                                </div>
                                <div th:replace="~{admin/BanhangTaiQuay/tablePhieuGiamGia :: nav}"></div>
                            </div>
                            <div th:replace="~{admin/BanhangTaiQuay/tablePhieuGiamGia :: script}"></div>
                        </div>
                    </div>
<!--                    <form id="formGiamGia" th:action="@{/admin/taiquay/kiemtrama}" method="get">-->
<!--                        <input type="text" name="maPhieuGiamGia" th:value="${maPhieuGiamGia}"/>-->
<!--                        &lt;!&ndash; Sử dụng thuộc tính đúng &ndash;&gt;-->
<!--                        <button type="submit">Áp dụng</button>-->
<!--                    </form>-->



                    <p style="font-size: 14px; margin-top: 10px;">Tiền Tạm Tính: <span id="subtotal" th:text="${#numbers.formatDecimal((tongTien != null ? tongTien : 0), 1, 'COMMA', 0, 'POINT')} + 'đ'">0</span>
                    </p>
                    <p style="font-size: 14px;">Số Tiền Giảm Giá: <span id="discount">0</span> đ</p>

                    <p>Tổng tiền sau khi áp dụng mã giảm giá:
<!--                        <span th:text="${#numbers.formatDecimal((tongTienSauGiam != null ? tongTienSauGiam : tongTien), 1, 'COMMA', 0, 'POINT')} + 'đ'"></span>-->
                        <span th:text="${#numbers.formatDecimal((tongTienSauGiam != null ? tongTienSauGiam : (tongTien != null ? tongTien : 0)), 1, 'COMMA', 0, 'POINT') + ' đ'}"></span>


                    </p>
                    <div th:if="${error}">
                        <p style="color: red;" th:text="${error}"></p>
                    </div>

                    <label style="margin-right: 50px;font-size: 14px;">Khách thanh toán: </label>
                    <a class="taiquay">
                        <a href="#thanhtoan">
                            <button class="bi bi-card-text" style="background-color: #2c3e50;"></button>
                        </a>
                    </a>
                    <div id="thanhtoan" class="modalthanhtoan">
                        <div class="modal__centerthanhtoan">


                            <form action="/admin/taiquay/thanhtoan" method="get" class="thanhtoan">
                                <div class="mb-3">
                                    <label class="col-3" style="font-size: 14px;margin-top: 10px;">Khách cần
                                        trả:</label>
                                    <b><span id="tongTien" style="font-size: 14px;" th:text="${#numbers.formatDecimal((tongTienSauGiam != null ? tongTienSauGiam : (tongTien != null ? tongTien : 0)), 1, 'COMMA', 0, 'POINT') + ' đ'}"></span></b>
                                    <input type="hidden" name="tongTien" th:value="${#numbers.formatDecimal((tongTienSauGiam != null ? tongTienSauGiam : (tongTien != null ? tongTien : 0)), 1, 'COMMA', 0, 'POINT') + ' đ'}"/>
                                </div>

                                <div class="received">
                                    <script src="https://cdnjs.cloudflare.com/ajax/libs/big.js/6.0.3/big.min.js"></script>
                                    <label>Số tiền khách đưa:</label>
                                    <input type="number" id="soTienKhachDua" name="soTienKhachDua"
                                           style="width: 200px;height: 20px" step="0.01" required
                                           oninput="tinhTienThua()"/>
                                </div>
                                <div class="change">
                                    <label>Tiền thừa:</label>
                                    <span id="tienThua">0</span> đ
                                </div>

                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <label style="font-size: 13px; margin-right: 10px;margin-top: 10px;">Phương
                                        thức:</label>

                                    <div class="form-check" style="display: flex; align-items: center;">
                                        <input class="form-check-input" style="margin-bottom: 5px;margin-top: 10px;"
                                               type="radio" name="phuongThucThanhToan" value="1">
                                        <label class="form-check-label"
                                               style="margin-right: 15px; margin-left: 5px;margin-top: 10px;font-size: 12px;">Tiền
                                            Mặt</label>
                                    </div>

                                    <div class="form-check" style="display: flex; align-items: center;">
                                        <input class="form-check-input" type="radio"
                                               style="margin-bottom: 5px;margin-top: 10px;" name="phuongThucThanhToan"
                                               value="2">
                                        <label class="form-check-label"
                                               style="margin-right: 15px;margin-left: 5px;margin-top: 10px;font-size: 12px;">Chuyển
                                            Khoản</label>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <label style="font-size: 14px; margin-right: 10px;margin-top: 10px;">Ghi
                                        Chú:</label>
                                    <div class="form-check" style="display: flex; align-items: center;">
                                        <input type="text" class="col-7" name="ghiChu"
                                               style="height: 20px;width:200px;margin-top: 10px;" th:value="${ghiChu}">
                                    </div>
                                </div>
                                <input type="hidden" name="maPhieuGiamGia" th:value="${maPhieuGiamGia}">
                                <button id="btnCheckout" type="submit"
                                        style="margin-top: 10px;background-color: #2c3e50;">Thanh Toán
                                </button>
                                <a href="#" class="modal__close">&times;</a>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </script>

    <!-- ComboBox Lọc Kích Cỡ -->
    <div id="sanpham" class="dialogmodal">
        <div class="modal__center">
            <h4>Sản phẩm</h4>
            <div th:replace="~{admin/BanhangTaiQuay/SPCTTable :: form}"></div>
            <!-- Table Sản phẩm -->
            <div th:replace="~{admin/BanhangTaiQuay/SPCTTable :: table}"></div>
            <a th:href="@{/admin/taiquay/detail/{id}(id=${idHoaDon})}" class="modal__close">&times;</a>

            <div style="margin-top: 15px" class="d-flex align-items-center">
                <label for="itemsPerPage" class="me-2">Xem</label>
                <select class="form-select form-select-sm" id="itemsPerPage2" name="size" onchange="changeItemsPerPage2()" style="width: 80px;">
                    <option value="5" th:selected="${size == 5}">5</option>
                    <option value="10" th:selected="${size == 10}">10</option>
                    <option value="15" th:selected="${size == 15}">15</option>
                    <option value="20" th:selected="${size == 20}">20</option>
                </select>
            </div>
            <div th:replace="~{admin/BanhangTaiQuay/SPCTTable :: nav}"></div>
            <div th:replace="~{admin/BanhangTaiQuay/SPCTTable :: script}"></div>
        </div>
    </div>
</section>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</section>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/javascript/admin.js}"></script>
<script th:src="@{/javascript/thanhtoan.js}"></script>
<script th:src="@{/javascript/taiquay.js}"></script>
<!--<script th:src="@{/javascript/locSanPhamTaiQuay.js}"></script>-->
</html>