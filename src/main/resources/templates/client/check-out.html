<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bee Shirt</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" th:href="@{/css/headerStyle.css}">
</head>
<body>

<header>
    <div class="header-container">
        <div class="logo">
            <a th:href="@{/client}">
                <img th:src="@{/img/LOGOYAGI.png}" alt="Bee Shirt" style="width: 48px; height: 48px;">
            </a>
        </div>
        <div class="product-options">
            <a href="#">Sản phẩm mới</a>
            <a href="#">Sale</a>
            <a href="#">Khuyến mãi</a>
        </div>
        <div class="header-icons">
            <img th:src="@{/img/nguoidung.png}" alt="User Icon" class="icon">
            <img th:src="@{/img/timkiem.png}" alt="Heart Icon" class="icon">
            <img th:src="@{/img/giohang.png}" alt="Cart Icon" class="icon">
        </div>
    </div>
</header>

<div class="container mt-4">
    <div class="bg-white p-3 shadow-sm rounded">
        <h3>Sản Phẩm</h3>
        <table class="table">
            <thead>
            <tr>
                <th scope="col">Hình ảnh</th>
                <th scope="col">Tên sản phẩm</th>
                <th scope="col">Đơn giá</th>
                <th scope="col">Số lượng</th>
                <th scope="col">Tổng</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="sp : ${listSP}">
                <td class="align-middle">
                    <img th:src="@{/img/{anhUrl}(anhUrl = ${sp.anhUrl})}"
                         alt="Shirt" class="rounded me-2" style="width: 100px; height: 100px;">
                </td>
                <td class="align-middle"
                    th:text="${sp.sanPhamGioHang.getSanPhamChiTiet().getSanPham().tenSanPham}"></td>
                <td class="align-middle" th:text="${#numbers.formatDecimal(sp.sanPhamGioHang.getSanPhamChiTiet().gia, 0, 'COMMA', 0, 'POINT')} + ' đ'"></td>
                <td class="align-middle" th:text="${sp.sanPhamGioHang.soLuong}"></td>
                <td class="align-middle" th:text="${#numbers.formatDecimal(sp.getSanPhamGioHang().tongTien(), 0, 'COMMA', 0, 'POINT')} + ' đ'"></td>
            </tr>
            </tbody>
        </table>
    </div>
    <form onsubmit="event.preventDefault(); guiDataThanhToan();" method="post">
        <div class="bg-white p-3 shadow-sm rounded mt-4">
            <h3>Thông Tin Nhận Hàng</h3>
            <div class="d-flex align-items-center mb-2">
                <img src="https://img.icons8.com/ios-filled/50/000000/map-marker.png" alt="Địa chỉ" class="me-2"
                     style="width: 20px; height: 20px;">
                <div>
                    <strong>Địa Chỉ Nhận Hàng</strong>
                </div>
            </div>
            <div>
                <strong>Lê Tuấn Phong</strong> (+84) 564005101<br>
                Làng Linh Quy Bắc Số nhà 74, Xã Kim Sơn, Huyện Gia Lâm, Hà Nội
            </div>
            <div class="mt-2">
                <button type="button" class="btn btn-danger btn-sm">Mặc Định</button>
                <button type="button" class="btn btn-link btn-sm">Thay Đổi</button>
            </div>
        </div>
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="bg-white p-3 shadow-sm rounded mb-3">
                    <h3>Mã ưu đãi</h3>
                    <div class="mb-3">
                        <label for="voucherCode" class="form-label">Mã ưu đãi</label>
                        <input type="text" class="form-control mb-2" id="voucherCode" value="GG304" disabled>
                        <p>Giảm 10% cho đơn từ đ100,000 Tối đa đ200,000</p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="bg-white p-3 shadow-sm rounded mb-3">
                    <h3>Thông tin thanh toán</h3>
                    <table class="table">
                        <tbody>
                        <tr>
                            <th scope="row">Giá giảm từ mã</th>
                            <td>10,000 đ</td>
                        </tr>
                        <tr>
                            <th scope="row">Phí vận chuyển</th>
                            <td th:text="${#numbers.formatDecimal(phiShip, 0, 'COMMA', 0, 'POINT')} + ' đ'"></td>
                        </tr>
                        <tr>
                            <th scope="row" class="fw-bold">Tổng tiền</th>
                            <td class="fw-bold text-danger"
                                th:text="${#numbers.formatDecimal(tongTien, 0, 'COMMA', 0, 'POINT')} + ' đ'"></td>
                        </tr>
                        </tbody>
                    </table>
                    <!-- Inline Payment Method Section -->
                    <div class="mt-4 mb-2">
                        <label class="form-label fw-bold">Phương thức thanh toán</label>
                        <div class="d-flex">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="paymentMethod" id="bankTransfer"
                                       value="5">
                                <label class="form-check-label" for="bankTransfer">Chuyển khoản ngân hàng</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="2"
                                       checked>
                                <label class="form-check-label" for="cod">Thanh toán khi nhận hàng (COD)</label>
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-danger w-100 mt-3">Thanh toán</button>
                </div>
            </div>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script th:inline="javascript">
    var listIDSPGH = /*[[${listIDSPGH}]]*/ '{}';
    var tongTien = /*[[${tongTien}]]*/ '{}'
</script>
<script>
    console.log(listIDSPGH)
    function guiDataThanhToan() {
        const paymentMethods = document.getElementsByName('paymentMethod');
        let selectedMethod;

        // Duyệt qua từng nút radio để tìm nút nào được chọn
        for (let i = 0; i < paymentMethods.length; i++) {
            if (paymentMethods[i].checked) {
                selectedMethod = paymentMethods[i].value; // Lấy giá trị của nút được chọn
                break;
            }
        }

        const formData = new FormData();
        formData.append('listIDSPGH', JSON.stringify(listIDSPGH)); // danh sách ID sản phẩm
        formData.append('tongTien', tongTien); // tổng tiền
        formData.append('pttt', selectedMethod); // phương thức thanh toán

        fetch('/client/thanh-toan', {
            method: 'POST',
            body: formData
        })
            .then(response => response.text())
            .then(() => {
                // Lưu trạng thái vào localStorage
                localStorage.setItem('paymentSuccess', 'true');
                // Chuyển hướng sang trang chính
                window.location.href = 'http://localhost:8080/client';
            })
            .catch(error => console.log(error));
    }
</script>
</body>
</html>
